function TCDriver_ConfigObject(){_TCDriver_Log("TCDriver_ConfigObject");var a,b=["endpoint","auth"],d=["activity_id","grouping","activity_platform","registration"],h={activity_id:"activityId",grouping:"grouping",activity_platform:"activityPlatform",registration:"registration"},f={},c=__parseQueryString(),g;a={recordStores:[],actor:null,actorJSON:null,activityId:null,activityName:null,activityDesc:null,activityPlatform:null,grouping:null,registration:null};if(c.hasOwnProperty("actor"))try{a.actor=
JSON.parse(c.actor),a.actorJSON=c.actor,delete c.actor}catch(i){_TCDriver_Log("TCDriver_ConfigObject - failed to parse actor: "+i)}for(var e=0;e<d.length;e+=1)g=d[e],c.hasOwnProperty(g)&&(a[h[g]]=c[g],delete c[g]);"undefined"!==typeof TC_COURSE_ID&&TC_COURSE_ID&&(null===a.activityId?a.activityId=TC_COURSE_ID:TC_COURSE_ID&&a.activityId!==TC_COURSE_ID&&_TCDriver_Log("TCDriver_ConfigObject - URL and pre-configured activity IDs differ"));null===a.activityName&&("undefined"!==typeof TC_COURSE_NAME&&TC_COURSE_NAME)&&
(a.activityName=TC_COURSE_NAME);null===a.activityDesc&&("undefined"!==typeof TC_COURSE_DESC&&TC_COURSE_DESC)&&(a.activityDesc=TC_COURSE_DESC);if(c.hasOwnProperty("endpoint")){for(e=0;e<b.length;e+=1)g=b[e],c.hasOwnProperty(g)&&(f[g]=c[g],delete c[g]);f.extended=c;f.allowFail=!1;a.recordStores.unshift(f)}if("undefined"!==typeof TC_RECORD_STORES&&0<TC_RECORD_STORES.length)for(e=0;e<TC_RECORD_STORES.length;e+=1)TC_RECORD_STORES[e].hasOwnProperty("endpoint")?a.recordStores.push(TC_RECORD_STORES[e]):_TCDriver_Log("TCDriver_ConfigObject - invalid record store (no 'endpoint'): "+
e),TC_RECORD_STORES[e].hasOwnProperty("allowFail")||(TC_RECORD_STORES[e].allowFail=!0);0===a.recordStores.length&&(_TCDriver_Log("TCDriver_ConfigObject - resulted in no LRS: DATA CANNOT BE STORED"),alert("No LRS: DATA CANNOT BE STORED"));return a}
function TCDriver_SendStatement(a,b,d){_TCDriver_Log("TCDriver_SendStatement");var h=__ruuid(),f,c,g=a.recordStores.length;if(0<g){_TCDriver_PrepareStatement(a,b);f=JSON.stringify(b);1===g?c=d:"function"===typeof d&&(c=function(){_TCDriver_Log("TCDriver_SendStatement - callbackWrapper: "+g);1<g?g-=1:1===g?d.apply(this,arguments):_TCDriver_Log("TCDriver_SendStatement - unexpected record store count: "+g)});for(var i=0;i<g;i+=1)b=a.recordStores[i],_TCDriver_XHR_request(b,"statements?statementId="+h,
"PUT",f,c)}}
function TCDriver_SendMultiStatements(a,b,d){_TCDriver_Log("TCDriver_SendMultiStatements");var h,f,c=a.recordStores.length;if(0<c&&null!=b&&0<b.length){for(var g=0;g<b.length;g++)_TCDriver_PrepareStatement(a,b[g]);h=JSON.stringify(b);1===c?f=d:"function"===typeof d&&(f=function(){_TCDriver_Log("TCDriver_SendMultiStatements - callbackWrapper: "+c);1<c?c-=1:1===c?d.apply(this,arguments):_TCDriver_Log("TCDriver_SendMultiStatements - unexpected record store count: "+c)});for(g=0;g<c;g+=1)b=a.recordStores[g],
_TCDriver_XHR_request(b,"statements","POST",h,f)}}function TCDriver_GetState(a,b,d,h){_TCDriver_Log("TCDriver_GetState: "+d);var f;if(0<a.recordStores.length)return f=a.recordStores[0],b="activities/state?activityId="+encodeURIComponent(b)+"&actor="+encodeURIComponent(a.actorJSON)+"&stateId="+encodeURIComponent(d),null!==a.registration&&(b+="&registration="+encodeURIComponent(a.registration)),a=_TCDriver_XHR_request(f,b,"GET",null,h,!0),"undefined"===typeof a||404===a.status?null:a.responseText}
function TCDriver_SetState(a,b,d,h,f){_TCDriver_Log("TCDriver_SetState: "+d);var c;0<a.recordStores.length&&(c=a.recordStores[0],b="activities/state?activityId="+encodeURIComponent(b)+"&actor="+encodeURIComponent(a.actorJSON)+"&stateId="+encodeURIComponent(d),null!==a.registration&&(b+="&registration="+encodeURIComponent(a.registration)),_TCDriver_XHR_request(c,b,"PUT",h,f))}
function TCDriver_DeleteState(a,b,d,h){_TCDriver_Log("TCDriver_DeleteState: "+d);var f;if(0<a.recordStores.length)return f=a.recordStores[0],b="activities/state?activityId="+encodeURIComponent(b)+"&actor="+encodeURIComponent(a.actorJSON)+"&stateId="+encodeURIComponent(d),null!==a.registration&&(b+="&registration="+encodeURIComponent(a.registration)),a=_TCDriver_XHR_request(f,b,"DELETE",null,h,!0),"undefined"===typeof a||404===a.status?null:a.responseText}
function TCDriver_SendActivityProfile(a,b,d,h,f,c){_TCDriver_Log("TCDriver_SendActivityProfile: "+d);var g=null,i,e=a.recordStores.length;if(0<e){b="activities/profile?activityId="+encodeURIComponent(b)+"&profileId="+encodeURIComponent(d);null!==f&&(g={"If-Matches":'"'+f+'"'});1===e?i=c:"function"===typeof c&&(i=function(){_TCDriver_Log("TCDriver_SendStatement - callbackWrapper: "+e);1<e?e-=1:1===e?c.apply(this,arguments):_TCDriver_Log("TCDriver_SendStatement - unexpected record store count: "+e)});
for(d=0;d<e;d+=1)f=a.recordStores[d],_TCDriver_XHR_request(f,b,"PUT",h,i,!1,g)}}function TCDriver_GetActivityProfile(a,b,d,h){_TCDriver_Log("TCDriver_GetActivityProfile: "+b);if(0<a.recordStores.length)return a=a.recordStores[0],b="activities/profile?activityId="+encodeURIComponent(b)+"&profileId="+encodeURIComponent(d),h=_TCDriver_XHR_request(a,b,"GET",null,h,!0),void 0===h||404===h.status?null:h.responseText}
function TCDriver_GetStatements(a,b,d,h,f){_TCDriver_Log("TCDriver_GetStatements");var c,g;if(0<a.recordStores.length)return g=a.recordStores[0],c="statements/?sparse=false",b&&(c+="&actor="+encodeURIComponent(a.actorJSON)),null!==d&&(c+="&verb="+d),null!==h&&(b={id:h},c+="&object="+encodeURIComponent(JSON.stringify(b))),a.registration&&(c+="&registration="+encodeURIComponent(a.registration)),_TCDriver_XHR_request(g,c,"GET",null,f).responseText}
function TCDriver_ISODateString(a){function b(a,b){null==a&&(a=0);null==b&&(b=2);for(var f=Math.pow(10,b-1),c=a.toString();a<f&&1<f;)c="0"+c,f/=10;return c}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"."+b(a.getUTCMilliseconds(),3)+"Z"}function _TCDriver_Log(a){"undefined"!==typeof console&&console.log(a)}
function _TCDriver_PrepareStatement(a,b){void 0===b.actor&&(b.actor=a.actor);if((a.grouping||a.registration||a.activityPlatform)&&!b.context)b.context={};a.grouping&&(b.context.contextActivities||(b.context.contextActivities={}),b.context.contextActivities.grouping={id:a.grouping});a.registration&&(b.context.registration=a.registration);a.activity_platform&&(b.context.platform=a.activityPlatform)}
function _TCDriver_XHR_request(a,b,d,h,f,c,g){function i(){_TCDriver_Log("requestComplete: "+m+", xhr.status: "+e.status);var a;if(m)return r;m=!0;a=c&&404===e.status;if(void 0===e.status||200<=e.status&&400>e.status||a)if(f)f(e);else return r=e;else return alert("There was a problem communicating with the Learning Record Store. ("+e.status+" | "+e.responseText+")"),e}_TCDriver_Log("_TCDriver_XHR_request: "+b);var e,m=!1,k=!1,p=!1,o,q=window.location,l,r,b=a.endpoint+b;l=b.toLowerCase().match(/^(.+):\/\/([^:\/]*):?(\d+)?(\/.*)?$/);
if(void 0!==a.extended){var k=[],j;for(j in a.extended)null!=a.extended[j]&&0<a.extended[j].length&&k.push(j+"="+encodeURIComponent(a.extended[j]));0<k.length&&(b+=(-1<b.indexOf("?")?"&":"?")+k.join("&"))}j={"Content-Type":"application/json"};j.Authorization=a.auth;if(null!==g)for(var n in g)j[n]=g[n];k=q.protocol.toLowerCase()!==l[1]||q.hostname.toLowerCase()!==l[2];k||(a=null===l[3]?"http"===l[1]?"80":"443":l[3],k=a===q.port);if(!k||"undefined"===typeof XDomainRequest)for(n in _TCDriver_Log("_TCDriver_XHR_request using XMLHttpRequest"),
e=new XMLHttpRequest,e.open(d,b,null!=f),j)e.setRequestHeader(n,j[n]);else _TCDriver_Log("_TCDriver_XHR_request using XDomainRequest"),p=!0,o=_TCDriver_GetIEModeRequest(d,b,j,h),e=new XDomainRequest,e.open(o.method,o.url);e.onreadystatechange=function(){e.readyState===4&&i()};e.onload=i;e.onerror=i;e.send(p?o.data:h);if(!f){if(p){d=1E3+Date.now();for(_TCDriver_Log("_TCDriver_XHR_request: until: "+d+", finished: "+m);Date.now()<d&&!m;)__delay()}return i()}}
function _TCDriver_GetIEModeRequest(a,b,d,h){_TCDriver_Log("_TCDriver_GetIEModeRequest");var f=[],c=b.indexOf("?");0<c&&(f.push(b.substr(c+1)),b=b.substr(0,c));b=b+"?method="+a;if(null!==d)for(var g in d)f.push(g+"="+encodeURIComponent(d[g]));null!==h&&f.push("content="+encodeURIComponent(h));return{method:"POST",url:b,headers:{},data:f.join("&")}}function __delay(){var a=new XMLHttpRequest,b=window.location+"?forcenocache="+__ruuid();a.open("GET",b,!1);a.send(null)}
function __parseQueryString(){var a={};if(1<window.location.search.length)for(var b,d=0,h=window.location.search.substr(1).split("&");d<h.length;d++){b=h[d].split("=");var f=a,c=unescape(b[0]);1<b.length?(b=unescape(b[1]),b=/^\s*$/.test(b)?null:/^(true|false)$/i.test(b)?"true"===b.toLowerCase():isFinite(b)?parseFloat(b):b):b=null;f[c]=b}_TCDriver_Log("__parseQueryString: "+JSON.stringify(a,null,4));return a}
function __ruuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}
window.JSON||(window.JSON={parse:function(a){return eval("("+a+")")},stringify:function(a){if(a instanceof Object){var b="";if(a.constructor===Array){for(var d=0;d<a.length;b+=this.stringify(a[d])+",",d++);return"["+b.substr(0,b.length-1)+"]"}if(a.toString!==Object.prototype.toString)return'"'+a.toString().replace(/"/g,"\\$&")+'"';for(d in a)b+='"'+d.replace(/"/g,"\\$&")+'":'+this.stringify(a[d])+",";return"{"+b.substr(0,b.length-1)+"}"}return"string"===typeof a?'"'+a.replace(/"/g,"\\$&")+'"':""+
a}});
